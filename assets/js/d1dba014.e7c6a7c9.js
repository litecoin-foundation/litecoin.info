"use strict";(self.webpackChunklitecoin_info=self.webpackChunklitecoin_info||[]).push([[32],{6972:(t,e,i)=>{i.r(e),i.d(e,{assets:()=>c,contentTitle:()=>s,default:()=>d,frontMatter:()=>o,metadata:()=>r,toc:()=>h});var n=i(4848),a=i(8453);const o={sidebar_position:1},s="Time Warp Attack",r={id:"history/time-warp-attack",title:"Time Warp Attack",description:"The time warp attack is based on a bug in Bitcoin and Litecoin (and their forks) where the difficulty calculation is off by one block.",source:"@site/docs/history/time-warp-attack.md",sourceDirName:"history",slug:"/history/time-warp-attack",permalink:"/docs/history/time-warp-attack",draft:!1,unlisted:!1,editUrl:"https://github.com/litecoin-foundation/litecoin.info/tree/main/packages/create-docusaurus/templates/shared/docs/history/time-warp-attack.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Initial Sync",permalink:"/docs/history/bootstrap"}},c={},h=[{value:"Zeitgeist2 Attack",id:"zeitgeist2-attack",level:3}];function l(t){const e={a:"a",code:"code",h1:"h1",h3:"h3",p:"p",pre:"pre",...(0,a.R)(),...t.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e.h1,{id:"time-warp-attack",children:"Time Warp Attack"}),"\n",(0,n.jsx)(e.p,{children:"The time warp attack is based on a bug in Bitcoin and Litecoin (and their forks) where the difficulty calculation is off by one block.\nThis flaw that affects all coins, especially ones with low network hash rates."}),"\n",(0,n.jsx)(e.p,{children:"An attacker can repeatedly try to generate the last block of each retarget window, and use a fabricated timestamp of two hours into\nthe future in order to make the time difference from the first block in the retarget window high, thus lowering the difficulty by 0.5%.\nDue to the bug, the bogus timestamp isn't used as the first block in the next retarget window, and therefore the two extra hours aren't\nbeing compensated for in the next difficulty calculation. Once the difficulty is low, the attacker can mine many fast coins, or in the\ncase of a small chain, an attacker with 51% hash power could reduce the difficulty to 1 and mine a new fork from the genesis block."}),"\n",(0,n.jsx)(e.p,{children:"This attack may not be as feasible any longer because the probability of repeatedly generating the last block once every two weeks at such high difficulties may be negligible."}),"\n",(0,n.jsxs)(e.p,{children:["Additional information is available from ArtForz: ",(0,n.jsx)(e.a,{href:"https://bitcointalk.org/index.php?topic=43692.msg521772#msg521772",children:"https://bitcointalk.org/index.php?topic=43692.msg521772#msg521772"})]}),"\n",(0,n.jsx)(e.h3,{id:"zeitgeist2-attack",children:"Zeitgeist2 Attack"}),"\n",(0,n.jsx)(e.p,{children:"A fix in Litecoin's code has prevented one type of time warp attack, the Zeitgeist2 51% attack.\nThe following changes were made to Litecoin Core to prevent the Zeitgeist2 attack:"}),"\n",(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:"language-cpp",metastring:'title="src/pow.cpp" link="https://github.com/litecoin-project/litecoin/commit/a66fc11fc4a7f7c0e35e127f2ae5753833a266e5#diff-4667f00c3a075be2753aa6ebdeea4bdbb66ef6e0b3d6df313a430f2eb8669ffdL41"',children:"unsigned int GetNextWorkRequired(const CBlockIndex* pindexLast, const CBlockHeader *pblock, const Consensus::Params& params)\n{\n    // [...]\n\n    // Go back by what we want to be 14 days worth of blocks\n// highlight-start\n-    int nHeightFirst = pindexLast->nHeight - (params.DifficultyAdjustmentInterval()-1);\n-    assert(nHeightFirst >= 0);\n-    const CBlockIndex* pindexFirst = pindexLast->GetAncestor(nHeightFirst);\n+    // Litecoin: This fixes an issue where a 51% attack can change difficulty at will.\n+    // Go back the full period unless it's the first retarget after genesis. Code courtesy of Art Forz\n+    int blockstogoback = params.DifficultyAdjustmentInterval()-1;\n+    if ((pindexLast->nHeight+1) != params.DifficultyAdjustmentInterval())\n+        blockstogoback = params.DifficultyAdjustmentInterval();\n// highlight-end\n\n// highlight-start\n+    // Go back by what we want to be 14 days worth of blocks\n+    const CBlockIndex* pindexFirst = pindexLast;\n+    for (int i = 0; pindexFirst && i < blockstogoback; i++)\n+        pindexFirst = pindexFirst->pprev;\n// highlight-end\n\n}\n\nunsigned int CalculateNextWorkRequired(const CBlockIndex* pindexLast, int64_t nFirstBlockTime, const Consensus::Params& params)\n{\n    // Retarget\n// highlight-start\n-    const arith_uint256 bnPowLimit = UintToArith256(params.powLimit);\n// highlight-end\n    arith_uint256 bnNew;\n    arith_uint256 bnOld;\n    bnNew.SetCompact(pindexLast->nBits);\n// highlight-start\n+    bnOld = bnNew;\n+    // Litecoin: intermediate uint256 can overflow by 1 bit\n+    const arith_uint256 bnPowLimit = UintToArith256(params.powLimit);\n+    bool fShift = bnNew.bits() > bnPowLimit.bits() - 1;\n+    if (fShift)\n+        bnNew >>= 1;\n// highlight-end\n    bnNew *= nActualTimespan;\n    bnNew /= params.nPowTargetTimespan;\n// highlight-start\n+    if (fShift)\n+        bnNew <<= 1;\n// highlight-end\n}\n"})})]})}function d(t={}){const{wrapper:e}={...(0,a.R)(),...t.components};return e?(0,n.jsx)(e,{...t,children:(0,n.jsx)(l,{...t})}):l(t)}},8453:(t,e,i)=>{i.d(e,{R:()=>s,x:()=>r});var n=i(6540);const a={},o=n.createContext(a);function s(t){const e=n.useContext(o);return n.useMemo((function(){return"function"==typeof t?t(e):{...e,...t}}),[e,t])}function r(t){let e;return e=t.disableParentContext?"function"==typeof t.components?t.components(a):t.components||a:s(t.components),n.createElement(o.Provider,{value:e},t.children)}}}]);